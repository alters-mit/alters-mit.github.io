<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Clatter</title>
    <meta name="description" content="Clatter API Documentation">
    <meta name="author" content="Esther Alter">

    <link rel="stylesheet" href="style.css?">
    <script src="highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

</head>

<body>

    <div class="navbar clear nav-top">
        <div class="navbar-row">
            <p>Clatter API </p>
            <p><a class="right" href="https://github.com/alters-mit/clatter">GitHub Repo</a></p>
        </div>
        <div class="container nav-container">
            <input class="checkbox" type="checkbox" name="" id="" />
            <div class="hamburger-lines">
              <span class="line line1"></span>
              <span class="line line2"></span>
              <span class="line line3"></span>
            </div>
            <div class="menu-items">
                <li><a class="left" href="index.html"><strong>Clatter API</strong></a></li>
                <li><div class="divider-menu"></div></li>
                <li><a class="left" href="https://github.com/alters-mit/clatter"><strong>GitHub Repo</strong></a></li>
                <li><div class="divider-menu"></div></li>
<li><a href="clatter.core_overview.html"><strong>Clatter.Core</strong></a></li>
                <li><a href="AudioEvent.html">AudioEvent</a></li>
                <li><a href="AudioEventType.html">AudioEventType</a></li>
                <li><a href="AudioGenerator.html">AudioGenerator</a></li>
                <li><a href="ClatterObjectData.html">ClatterObjectData</a></li>
                <li><a href="CollisionEvent.html">CollisionEvent</a></li>
                <li><a href="DoubleExtensions.html">DoubleExtensions</a></li>
                <li><a href="EventState.html">EventState</a></li>
                <li><a href="Globals.html">Globals</a></li>
                <li><a href="Impact.html">Impact</a></li>
                <li><a href="ImpactMaterial.html">ImpactMaterial</a></li>
                <li><a href="ImpactMaterialData.html">ImpactMaterialData</a></li>
                <li><a href="ImpactMaterialUnsized.html">ImpactMaterialUnsized</a></li>
                <li><a href="LinSpace.html">LinSpace</a></li>
                <li><a href="Loader.html">Loader</a></li>
                <li><a href="MedianFilter.html">MedianFilter</a></li>
                <li><a href="Modes.html">Modes</a></li>
                <li><a href="NormalDistribution.html">NormalDistribution</a></li>
                <li><a href="Samples.html">Samples</a></li>
                <li><a href="Scrape.html">Scrape</a></li>
                <li><a href="ScrapeMaterial.html">ScrapeMaterial</a></li>
                <li><a href="ScrapeMaterialData.html">ScrapeMaterialData</a></li>
                <li><a href="ShortExtensions.html">ShortExtensions</a></li>
                <li><a href="Vector3d.html">Vector3d</a></li>
                <li><a href="WavWriter.html">WavWriter</a></li>
                <li><div class="divider-menu"></div></li>
                <li><a href="clatter.unity_overview.html"><strong>Clatter.Unity</strong></a></li>
                <li><a href="ClatterManager.html">ClatterManager</a></li>
                <li><a href="ClatterObject.html">ClatterObject</a></li>
                <li><a href="ImpactSound.html">ImpactSound</a></li>
                <li><a href="MassMode.html">MassMode</a></li>
                <li><a href="PhysicMaterialMode.html">PhysicMaterialMode</a></li>
                <li><a href="ScrapeSound.html">ScrapeSound</a></li>
                <li><a href="Sound.html">Sound</a></li>
                <li><a href="Vector3dExtensions.html">Vector3dExtensions</a></li>
                <li><div class="divider-menu"></div></li>
                <li><a href="cli_overview.html"><strong>Clatter CLI</strong></a></li>
                <li><div class="divider-menu"></div></li>
                <li><a href="benchmark.html">Benchmark</a></li>
            </div>
        </div>
    </div>

    <div class="container clear">
        <div class="row wrapper">		<div class="sidepanel">
				<a class="title" href="index.html">Overview</a>


				<div class="divider left"></div>

				<a class="title" href="clatter.core_overview.html">Clatter.Core</a>

				<a class="section" href="AudioEvent.html">AudioEvent</a>
				<a class="section" href="AudioEventType.html">AudioEventType</a>
				<a class="section" href="AudioGenerator.html">AudioGenerator</a>
				<a class="section" href="ClatterObjectData.html">ClatterObjectData</a>
				<a class="section" href="CollisionEvent.html">CollisionEvent</a>
				<a class="section" href="DoubleExtensions.html">DoubleExtensions</a>
				<a class="section" href="EventState.html">EventState</a>
				<a class="section" href="Globals.html">Globals</a>
				<a class="section" href="Impact.html">Impact</a>
				<a class="section" href="ImpactMaterial.html">ImpactMaterial</a>
				<a class="section" href="ImpactMaterialData.html">ImpactMaterialData</a>
				<a class="section" href="ImpactMaterialUnsized.html">ImpactMaterialUnsized</a>
				<a class="section" href="LinSpace.html">LinSpace</a>
				<a class="section" href="Loader.html">Loader</a>
				<a class="section" href="MedianFilter.html">MedianFilter</a>
				<a class="section" href="Modes.html">Modes</a>
				<a class="section" href="NormalDistribution.html">NormalDistribution</a>
				<a class="section" href="Samples.html">Samples</a>
				<a class="section" href="Scrape.html">Scrape</a>
				<a class="section" href="ScrapeMaterial.html">ScrapeMaterial</a>
				<a class="section" href="ScrapeMaterialData.html">ScrapeMaterialData</a>
				<a class="section" href="ShortExtensions.html">ShortExtensions</a>
				<a class="section" href="Vector3d.html">Vector3d</a>
				<a class="section" href="WavWriter.html">WavWriter</a>

				<div class="divider left"></div>

				<a class="title" href="clatter.unity_overview.html">Clatter.Unity</a>

				<a class="section" href="ClatterManager.html">ClatterManager</a>
				<a class="section" href="ClatterObject.html">ClatterObject</a>
				<a class="section" href="ImpactSound.html">ImpactSound</a>
				<a class="section" href="MassMode.html">MassMode</a>
				<a class="section" href="PhysicMaterialMode.html">PhysicMaterialMode</a>
				<a class="section" href="ScrapeSound.html">ScrapeSound</a>
				<a class="section" href="Sound.html">Sound</a>
				<a class="section" href="Vector3dExtensions.html">Vector3dExtensions</a>

				<div class="divider left"></div>

				<a class="title" href="cli_overview.html">Clatter CLI</a>


				<div class="divider left"></div>

				<a class="title" href="benchmark.html">Benchmark</a>
			</div>
		<div class="right-col">

<h1>AudioGenerator</h1>

<p class="subtitle">class in Clatter.Core</p>

<p>An AudioGenerator can generate audio within a dynamic physics simulation.</p>
<p>AudioGenerator is not required for audio generation but is usually your best option, for two reasons. First, AudioGenerator automatically converts <a href="CollisionEvent.html"><code>CollisionEvent</code></a> data into audio data, meaning that it's suitable for physics simulation. Second, AudioGenerator is multi-threaded, meaning that concurrent audio generation is very fast.</p>

<p>AudioGenerator is structured like a UnityEngine MonoBehaviour object but it isn't a subclass of MonoBehaviour and won't update like one; Update() needs to be called manually.</p>

<p>Regarding randomness: AudioGenerator has an rng parameter that is a System.Random object. In Clatter, audio is generated from both fixed values and random values; see the constructor for <a href="Modes.html"><code>Modes</code></a> and <a href="Modes.html"><code>Modes</code></a>.AdjustPowers(). In most cases, you'll want the audio to be truly random. If you want to replicate the exact same audio every time you run your program, set a random seed: Random rng = new Random(0).</p><h2>Static Fields</h2>

<table>
	<tr>
		<th><strong>Name</strong></th><th>
		<strong>Type</strong></th>
		<th><strong>Description</strong></th>
		<th><strong>Default Value</strong></th>
	</tr>
	<tr>
		<th>maxNumAudioEvents</th>
		<th>int</th>
		<th>The maximum number of impacts, scrapes, and rolls that can occur on one frame. After this many events, any new audio events are ignored. </th>
		<th>200</th>
	</tr>
</table>

<h2>Fields</h2>

<table>
	<tr>
		<th><strong>Name</strong></th><th>
		<strong>Type</strong></th>
		<th><strong>Description</strong></th>
		<th><strong>Default Value</strong></th>
	</tr>
	<tr>
		<th>onImpact</th>
		<th>AudioGenerationAction</th>
		<th>Invoked when impact audio is generated. </th>
		<th></th>
	</tr>
	<tr>
		<th>onScrapeStart</th>
		<th>AudioGenerationAction</th>
		<th>Invoked when audio is generated by a new scrape event. </th>
		<th></th>
	</tr>
	<tr>
		<th>onScrapeOngoing</th>
		<th>AudioGenerationAction</th>
		<th>Invoked when audio is generated by an ongoing scrape event. </th>
		<th></th>
	</tr>
	<tr>
		<th>onScrapeEnd</th>
		<th>Action< int ></th>
		<th>Invoked when a scrape ends. </th>
		<th></th>
	</tr>
</table>

<h2>Delegates</h2>

<h3>AudioGenerationAction</h3>

<p><code>public delegate void AudioGenerationAction(CollisionEvent collisionEvent, Samples samples, Vector3d position, int audioSourceId)</code></p>

<p>Delegate for actions that are invoked during audio generation.</p>

<table>
	<tr>
		<th><strong>Name</strong></th><th>
		<strong>Type</strong></th>
		<th><strong>Description</strong></th>
	</tr>
	<tr>
		<th>collisionEvent</th>
		<th><a href="CollisionEvent.html"><code>CollisionEvent</code></a></th>
		<th>The collision event that generated the audio.</th>
	</tr>	<tr>
		<th>samples</th>
		<th><a href="Samples.html"><code>Samples</code></a></th>
		<th>The audio samples.</th>
	</tr>	<tr>
		<th>position</th>
		<th><a href="Vector3d.html"><code>Vector3d</code></a></th>
		<th>The position of the audio source.</th>
	</tr>	<tr>
		<th>audioSourceId</th>
		<th>int</th>
		<th>The audio source ID.</th>
	</tr>
</table>

<h2>Methods</h2>

<h3>AudioGenerator</h3>

<p><code>public AudioGenerator(IEnumerable< ClatterObjectData > clatterObjects, int? seed=null)</code></p>

<table>
	<tr>
		<th><strong>Name</strong></th><th>
		<strong>Type</strong></th>
		<th><strong>Description</strong></th>
	</tr>
	<tr>
		<th>clatterObjects</th>
		<th><a href="ClatterObjectData.html"><code>ClatterObjectData</code></a></th>
		<th>The objects that will generate audio.</th>
	</tr>	<tr>
		<th>seed</th>
		<th>int?</th>
		<th>The random seed. If null, the seed is random.</th>
	</tr>
</table>

<h3>Update</h3>

<p><code>public void Update()</code></p>

<p>Call this once per frame to process collision events and generate audio.</p>

<h3>AddCollision</h3>

<p><code>public void AddCollision(CollisionEvent collisionEvent)</code></p>

<p>Register a new collision audio event.</p>

<table>
	<tr>
		<th><strong>Name</strong></th><th>
		<strong>Type</strong></th>
		<th><strong>Description</strong></th>
	</tr>
	<tr>
		<th>collisionEvent</th>
		<th><a href="CollisionEvent.html"><code>CollisionEvent</code></a></th>
		<th>The collision event.</th>
	</tr>
</table>

<h3>End</h3>

<p><code>public void End()</code></p>

<p>Call this to announce to kill lingering threads.</p>



<h2>Code Examples</h2>



<p>This is a minimal example of how to process multiple concurrent collisions with an AudioGenerator and, using <a href="WavWriter.html"><code>WavWriter</code></a>, write .wav files. Note that we're making a few implausible assumptions:</p>

<ul>

<li>

<p>All of the objects are randomly generated. In a real simulation, you'll probably want more control over the objects' audio values.</p>

</li>

<li>

<p>All of the collisions have a centroid of (0, 0, 0). In a real simulation, the collisions should probably be spatialized.</p>

</li>

<li>

<p>All of the collision events are impacts. In a real simulation, we could add a <computeroutput>ScrapeMaterial</computeroutput> to a "floor" object to start generating scrape audio.</p>

</li>

</ul>

<p></p>
<pre><code>using System;
using System.IO;
using Clatter.Core;

public static class AudioGeneratorImpact
{
    private static AudioGenerator generator;
    private static Queue<byte[]> audioData = new Queue<byte[]>();
    
    public static void Main(string[] args)
    {
        Random rng = new Random();
        // Add some objects.
        ClatterObjectData[] objects = new ClatterObjectData[64];
        uint[] objectIds = new uint[64];
        for (uint i = 0; i < objects.Length; i++)
        {
            // Generate a random object.
            objects[i] = new ClatterObjectData(i, ImpactMaterial.glass_1, rng.NextDouble(), rng.NextDouble(), rng.NextDouble() * 5);
            objectIds[i] = i;
        }
        // Create the audio generator.
        generator = new AudioGenerator(objects);
        // Listen for impact events.
        generator.onImpact += OnImpact;
        // Get the output directory.
        string outputDirectory = Path.GetFullPath("output");
        // Iterate for 15 frames.
        for (int i = 0; i < 15; i++)
        {
            // Get a random number of collisions.
            int numCollisions = rng.Next(15, 30);
            // Randomize the object IDs.
            objectIds = objectIds.OrderBy(x => rng.NextDouble()).ToArray();
            int objectIndex = 0;
            // Generate collisions.
            for (int j = 0; j < numCollisions; j++)
            {
                // Get random primary and secondary objects.
                ClatterObjectData primary = objects[objectIds[objectIndex]];
                ClatterObjectData secondary = objects[objectIds[objectIndex + 1]];
                // Generate a collision.
                CollisionEvent collisionEvent = new CollisionEvent(primary, secondary, AudioEventType.impact, rng.NextDouble() * 1.75, Vector3d.Zero);
                // Add the collision.
                generator.AddCollision(collisionEvent);
                // Increment the object index for the next collision.
                objectIndex += 2;
                if (objectIndex >= objects.Length)
                {
                    objectIndex = 0;
                }
            }
            // Update.
            generator.Update();
            // Write the audio wav data.
            int audioIndex = 0;
            while (audioData.Count > 0)
            {
                WavWriter writer = new WavWriter(Path.Combine(outputDirectory, audioIndex + ".wav"));
                writer.Write(audioData.Dequeue());
                writer.End();
                audioIndex++;
            }
        }
    }


    private static void OnImpact(CollisionEvent collisionEvent, Samples samples, Vector3d centroid, int audioSourceId)
    {
        audioData.Enqueue(samples.ToInt16Bytes());
    }
}</code></pre>

<p></p></div></div></div></body></html>